<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NeuroSense Report - {{ patientName }}</title>
  <style>
    body { font-family: Arial, sans-serif; color: #111; margin: 0; padding: 0; }
    .container { padding: 20px; }
    .report-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom: 18px; }
    .header-left { flex: 1; text-align: left; }
    .header-center { flex: 1; text-align: center; }
    .header-right { flex: 1; text-align: right; font-size: 12px; color: #666; }
    .brand { font-size: 20px; font-weight: 800; color: #87CEEB; letter-spacing: 0.4px; }
    .meta { font-size: 12px; color: #666; }
    .section { margin-top: 20px; padding-bottom: 12px; }
    .thumbs img { max-width: 320px; border: 1px solid #ddd; margin-right: 8px; display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { border: 1px solid #bbb; padding: 8px 10px; text-align: left; font-size: 12px }
    th { background: #f5f7fa; }
    h2 { margin: 12px 0; font-size: 16px }
    .ensemble { margin-top: 12px; padding: 10px; background: #f7f7ff; border-left: 4px solid #4f46e5; }
    .footer { margin-top: 24px; font-size: 11px; color: #444; text-align: center; }
  .spacer { height: 8px; }
  .header-row-gap { margin-top: 8px; }
    .input-row { display:flex; align-items:flex-start; }
    .input-right { flex:1; margin-left:12px; }
    .charts-row { display:flex; gap:12px; align-items:flex-start; }
    .chart-img { max-width:45%; }
    .technical-pre { font-size:11px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-center">
        <div class="brand">NeuroSense — Epileptic Seizure Prediction</div>
      </div>
      <div class="spacer"></div>
  <div class="report-header header-row-gap">
        <div class="header-left">
          <div><strong>Patient name :</strong> {{ patientName or '—' }}</div>
          <div class="meta"><strong>Patient ID :</strong> {{ patientId or '—' }}</div>
        </div>
        <div class="header-right">
          <div><strong>Date&Time :</strong> {{ generated_at }}</div>
        </div>
      </div>
    </header>

    <section class="section">
      <h2>Input Details</h2>
      <div class="input-row">
        <div class="thumbs">
          {% if uploaded_image_preview %}
            <img src="{{ uploaded_image_preview }}" alt="uploaded" />
          {% endif %}
          {% if spectrogram_image_preview %}
            <img src="{{ spectrogram_image_preview }}" alt="spectrogram" />
          {% endif %}
        </div>
        <div class="input-right">
          <table>
            <tr><th>EEG File</th><td>{{ eegFileName }}</td></tr>
            <tr><th>Uploaded</th><td>{{ generated_at }}</td></tr>
          </table>
        </div>
      </div>
    </section>

    <section class="section">
      <h2>Model Predictions</h2>
      <table>
        <thead><tr><th>Model</th><th>Non-seizure (%)</th><th>Preictal (%)</th><th>Seizure (%)</th></tr></thead>
        <tbody>
          <tr>
            <td>Hybrid CNN+BILSTM</td>
            <td>{{ hybrid.probabilities.non_seizure }}</td>
            <td>{{ hybrid.probabilities.preictal }}</td>
            <td>{{ hybrid.probabilities.seizure }}</td>
          </tr>
          <tr>
            <td>CNN Baseline</td>
            <td>{{ cnn.probabilities.non_seizure }}</td>
            <td>{{ cnn.probabilities.preictal }}</td>
            <td>{{ cnn.probabilities.seizure }}</td>
          </tr>
        </tbody>
      </table>
      <div class="ensemble">
        <strong>Ensemble decision:</strong> {{ ensemble.decision }} — Confidence: {{ ensemble.probability }}% (threshold: {{ ensemble.threshold }})
      </div>
    </section>

    <section class="section">
      <h2>Charts</h2>
      <div class="charts-row">
        {% if charts.model_comparison_png %}
          <img src="{{ charts.model_comparison_png }}" alt="model comparison" class="chart-img" />
        {% endif %}
        {% if charts.confidence_trend_png %}
          <img src="{{ charts.confidence_trend_png }}" alt="confidence trend" class="chart-img" />
        {% endif %}
      </div>
    </section>

    <section class="section">
      <h2>Clinical Interpretation & Recommendations</h2>
      <p>{{ clinical_text }}</p>
    </section>

    <section class="section">
      <h2>Technical Summary</h2>
      <pre class="technical-pre">{{ technical }}</pre>
    </section>
    <footer class="footer">
      Generated automatically by NeuroSense System • For clinical assistance only • Version 1.0.0
    </footer>
  </div>
</body>
</html>
